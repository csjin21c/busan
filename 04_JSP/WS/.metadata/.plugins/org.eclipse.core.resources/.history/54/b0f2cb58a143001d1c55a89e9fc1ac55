package pkgJDBC;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

public class BbsDAO {
	private Connection conn;
	private ResultSet rs;
	
	public void BbsDAO() {
		//bbsConnect();
	} 
	
	/* #########################################################################
		데이터베이스 연결 메서드
	######################################################################### */
	public void bbsConnect() {
		try {
			String dbURL = "jdbc:mysql://localhost:3306/study";
			String dbID = "devUser";
			String dbPassw = "devUser2022!";
			
			Class.forName("com.mysql.cj.jdbc.Driver");
			conn = DriverManager.getConnection(dbURL, dbID, dbPassw);
			System.out.println("DB연결 성공");
		}
		catch(Exception e) {
			System.out.println("DB연결 실패");
			e.printStackTrace();
		}
	}//e:bbsConnect()
	

	/* #########################################################################
		신규 글 삽입을 위한 idx와 list값을 생성하는 메서드
		Map 사용연습을 위해 배열을 을 사용하여 구성함.
	######################################################################### */
	public Map<String, Integer> getIdx() {
		Map<String, Integer> mapOutput = new HashMap<>();
		try {
			bbsConnect();
			String SQL="SELECT IFNULL(MAX(FIDX)+1,1) "
					+ " FROM TBOARD";
			PreparedStatement pstmt = conn.prepareStatement(SQL);
			System.out.println("Statement객체 생성 성공");
			
			rs = pstmt.executeQuery();
			if (rs.next()) {
				mapOutput.put("idx", rs.getInt("aidx"));//String로 데이터 변경하여 처리
			}
			rs.close();//result set 객체를 닫아줌.
			return mapOutput;//반환 받은 FIDX값을 반환
		}catch(Exception e) {
			return null;//에러 발생시
		}
	}//e:getIdx()

	/* #########################################################################
		게시판 목록을 만들기 위한 설정.
	######################################################################### */
	public ArrayList<BoardField> getList(int pageNum) {
		String SQL = "SELECT * FROM TBOARD_PART ORDER BY FIDX DESC LIMIT ? 10 ";
		ArrayList<BoardField> boardList = new ArrayList<BoardField>();
		try {
			PreparedStatement pstmt = conn.prepareStatement(SQL);
			pstmt.setInt(1,  ((pageNum - 1) * 10));
			pstmt.setInt(2,  groupNum);
			rs = pstmt.executeQuery();
			while(rs.next()) {
				BoardField board = new BoardField();
				board.setIdx(rs.getInt("fidx"));
				board.setPart(rs.getInt("fpart"));
				boardList.add(board);
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
		return boardList;
	}
	
}//e:class BbsDAO

